<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.2/p5.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.2/addons/p5.sound.min.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <script>
      let mic;
      let temblar;

      function setup() {
        createCanvas(windowWidth, windowHeight);
        mic = new p5.AudioIn();
        mic.start();
      }

      function draw() {
        temblar = random(10, 50);
        let vol = mic.getLevel();
        let h = map(vol, 0, 1, 0, 800);

        background(0, 255 - h, 155);

        // Cara circular tipo simp치tica
        fill(247, 220, 180);
        noStroke();
        ellipse(windowWidth / 2, windowHeight / 2, 320 + temblar, 320 + temblar);

        // GORRA cartoon LADO IZQUIERDO (mejorada y m치s natural)
        push();
        let gorraBaseX = windowWidth / 2 - 70;
        let gorraBaseY = windowHeight / 2 - 170;
        // Parte principal gorra
        fill(220, 40, 60);
        arc(gorraBaseX, gorraBaseY, 160, 80, PI, 0, CHORD);
        // Visera
        fill(140, 20, 36);
        arc(gorraBaseX - 60, gorraBaseY + 15, 90, 32, PI + QUARTER_PI / 2, TWO_PI, OPEN);
        // Bot칩n
        fill(80, 0, 0);
        ellipse(gorraBaseX, gorraBaseY - 38, 24, 12);
        pop();

        // OJOS
        let eyeY = windowHeight / 2 - 40;
        let eyeDX = 60 + h * 0.05;
        fill(255);
        ellipse(windowWidth / 2 - eyeDX, eyeY, 54, 38);
        ellipse(windowWidth / 2 + eyeDX, eyeY, 54, 38);
        // Pupilas
        fill(40, 70, 120);
        ellipse(windowWidth / 2 - eyeDX, eyeY, 18, 22 + h * 0.05);
        ellipse(windowWidth / 2 + eyeDX, eyeY, 18, 22 + h * 0.05);

        // CEJAS ARQUEADAS
        stroke(70, 40, 10);
        strokeWeight(7);
        noFill();
        // Izquierda
        arc(windowWidth / 2 - eyeDX, eyeY - 28, 50, 22, PI + QUARTER_PI / 2, TWO_PI - QUARTER_PI / 2);
        // Derecha
        arc(windowWidth / 2 + eyeDX, eyeY - 28, 50, 22, PI + QUARTER_PI / 2, TWO_PI - QUARTER_PI / 2);

        // NARIZ simp치tica (ovalada)
        noStroke();
        fill(255, 180, 120);
        ellipse(windowWidth / 2, windowHeight / 2 + 16, 30, 18);

        // BOCA animada y expresiva
        stroke(180, 40, 50);
        strokeWeight(6);
        noFill();
        let mouthY = windowHeight / 2 + 70;
        let smile = map(vol, 0, 1, 6, 50);
        arc(windowWidth / 2, mouthY, 90, 40 + smile, 0, PI, CHORD);

        // Mejillas
        noStroke();
        fill(255, 150, 160, 90 + smile);
        ellipse(windowWidth / 2 - 54, windowHeight / 2 + 44, 28, 17);
        ellipse(windowWidth / 2 + 54, windowHeight / 2 + 44, 28, 17);
      }
    </script>
  </body>
</html>
